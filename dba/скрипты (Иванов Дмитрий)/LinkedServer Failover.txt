DECLARE @srv NVARCHAR (128), @bd NVARCHAR (128), @user NVARCHAR (128), @pass NVARCHAR (128), @ssrv NVARCHAR (128), @dsrv NVARCHAR (128), @prvstr NVARCHAR (1024)
SET @srv = N'SRV-BILLING'							--имя линка
SET @bd = N'Billing3'						--имя базы
SET @user = N'User_Billing3_Linked'							--логин пользователя (должен быть зарегестрирован SQL login на сервере источнике)
SET @pass = N''						--парол пользователя
SET @ssrv = N'SRV-PRO-DB13.I-FREE.PRO'		--сервер источник
SET @dsrv = N'SRV-PRO-DB14.I-FREE.PRO'		--файловер сервер
SET @prvstr = 'Server='+@ssrv+';FailoverPartner='+@dsrv
--PRINT (@ssrv)
--PRINT (@dsrv)
--PRINT (@prvstr)
IF  EXISTS (SELECT srv.name FROM sys.servers srv WHERE srv.server_id != 0 AND srv.name = @srv)
EXEC master.dbo.sp_dropserver @server=@srv, @droplogins='droplogins'
EXEC master.dbo.sp_addlinkedserver @server = @srv
, @srvproduct= @ssrv 
, @provider=N'SQLNCLI'
, @provstr= @prvstr
, @catalog= @bd
EXEC master.dbo.sp_addlinkedsrvlogin 
@rmtsrvname= @srv
,@useself=N'False'
,@locallogin=NULL
,@rmtuser= @user
,@rmtpassword= @pass






EXEC master.dbo.sp_addlinkedserver @server = N'SRV-APP', @srvproduct=N'SRV-PRO-DB09', @provider=N'SQLNCLI', @provstr=N'Server=SRV-PRO-DB09;FailoverPartner=SRV-PRO-DB10', @catalog=N'IVRBilling'
 /* For security reasons the linked server remote logins password is changed with ######## */
EXEC master.dbo.sp_addlinkedsrvlogin @rmtsrvname=N'SRV-APP',@useself=N'False',@locallogin=NULL,@rmtuser=N'IVRLogGate',@rmtpassword='########'

