-- Удаляем по классике таблицы перед созданием
IF EXISTS (SELECT * FROM sys.tables WHERE name = N'SalesSource')
    DROP TABLE SalesSource;
IF EXISTS (SELECT * FROM sys.tables WHERE name = N'SalesTarget')
    DROP TABLE SalesTarget;
 
-- Создаём не секционированную таблицу источник (Кучу) в файловой группе [PRIMARY]
CREATE TABLE SalesSource (
    SalesDate DATE,
    Quantity INT
) ON [PRIMARY];
 
-- Вставляем тестовые данные
INSERT INTO SalesSource([SalesDate],[Quantity]) VALUES('09.11.18',28),('09.11.18',95),('08.11.18',533),('09.11.18',370),('08.11.18',656),('09.11.18',379),('07.11.18',897),('09.11.18',475),('07.11.18',334),('09.11.18',801),('09.11.18',584),('07.11.18',613),('07.11.18',920),('09.11.18',234),('07.11.18',881),('09.11.18',189),('09.11.18',9),('09.11.18',974),('08.11.18',739),('08.11.18',193),('09.11.18',775),('09.11.18',440),('08.11.18',186),('07.11.18',755),('08.11.18',348),('08.11.18',369),('09.11.18',611),('07.11.18',828),('09.11.18',489),('09.11.18',734),('09.11.18',623),('07.11.18',9),('09.11.18',910),('09.11.18',269),('08.11.18',227),('09.11.18',943),('08.11.18',262),('07.11.18',367),('09.11.18',427),('08.11.18',791),('07.11.18',252),('07.11.18',288),('08.11.18',669),('08.11.18',884),('09.11.18',947),('07.11.18',664),('08.11.18',587),('08.11.18',615),('09.11.18',989),('07.11.18',254),('08.11.18',574),('08.11.18',197),('08.11.18',827),('08.11.18',175),('08.11.18',375),('09.11.18',135),('09.11.18',878),('07.11.18',649),('07.11.18',645),('08.11.18',275),('09.11.18',352),('07.11.18',52),('09.11.18',785),('07.11.18',753),('09.11.18',139),('07.11.18',638),('08.11.18',975),('07.11.18',901),('08.11.18',983),('09.11.18',239),('09.11.18',32),('08.11.18',10),('07.11.18',115),('07.11.18',383),('08.11.18',754),('08.11.18',411),('09.11.18',910),('08.11.18',676),('07.11.18',983),('08.11.18',362),('08.11.18',843),('09.11.18',222),('09.11.18',928),('09.11.18',445),('09.11.18',670),('09.11.18',896),('09.11.18',940),('07.11.18',336),('08.11.18',299),('07.11.18',30),('09.11.18',962),('07.11.18',217),('08.11.18',686),('07.11.18',119),('07.11.18',267),('08.11.18',880),('09.11.18',345),('08.11.18',604),('08.11.18',796),('08.11.18',318);
GO 100
INSERT INTO SalesSource([SalesDate],[Quantity]) VALUES('07.11.18',424),('08.11.18',614),('08.11.18',391),('08.11.18',407),('09.11.18',418),('07.11.18',186),('07.11.18',896),('07.11.18',146),('08.11.18',973),('07.11.18',716),('07.11.18',942),('08.11.18',936),('09.11.18',531),('09.11.18',746),('08.11.18',784),('08.11.18',451),('09.11.18',895),('09.11.18',977),('09.11.18',299),('07.11.18',817),('07.11.18',236),('07.11.18',645),('09.11.18',740),('09.11.18',585),('09.11.18',779),('09.11.18',308),('09.11.18',847),('08.11.18',451),('09.11.18',265),('09.11.18',473),('09.11.18',971),('08.11.18',683),('08.11.18',975),('09.11.18',168),('08.11.18',71),('09.11.18',707),('09.11.18',785),('09.11.18',626),('09.11.18',844),('07.11.18',856),('08.11.18',536),('09.11.18',850),('09.11.18',31),('08.11.18',433),('07.11.18',401),('09.11.18',333),('08.11.18',453),('07.11.18',109),('08.11.18',857),('08.11.18',18),('09.11.18',733),('07.11.18',432),('09.11.18',718),('09.11.18',366),('07.11.18',883),('09.11.18',176),('09.11.18',252),('09.11.18',152),('08.11.18',685),('09.11.18',688),('08.11.18',576),('08.11.18',84),('09.11.18',741),('07.11.18',245),('08.11.18',425),('07.11.18',364),('09.11.18',483),('07.11.18',297),('08.11.18',758),('09.11.18',297),('07.11.18',453),('07.11.18',269),('07.11.18',829),('07.11.18',685),('09.11.18',945),('09.11.18',701),('07.11.18',556),('07.11.18',683),('08.11.18',625),('07.11.18',54),('07.11.18',240),('09.11.18',304),('09.11.18',686),('07.11.18',617),('09.11.18',395),('09.11.18',866),('09.11.18',714),('07.11.18',517),('09.11.18',821),('08.11.18',410),('07.11.18',445),('09.11.18',784),('09.11.18',374),('07.11.18',354),('07.11.18',959),('09.11.18',673),('07.11.18',593),('09.11.18',106),('07.11.18',146),('07.11.18',808);
GO 100


-- Создаем простую таблицу назначения (Кучу) в той же файловой группе [PRIMARY]
CREATE TABLE SalesTarget (
    SalesDate DATE,
    Quantity INT
) ON [PRIMARY];


-- Проверяем кол-во строк перед переключением секций
SELECT COUNT(*) FROM SalesSource; -- 20 000 строк
SELECT COUNT(*) FROM SalesTarget; -- 0 строк


-- Включаем статистику
SET STATISTICS TIME ON;

-- Проверяем на сколько это быстро работает
ALTER TABLE SalesSource SWITCH TO SalesTarget; 
-- работает очень быстро =)

-- Выключаем статистику
SET STATISTICS TIME OFF;

-- Проверяем кол-во строк после переключения
SELECT COUNT(*) FROM SalesSource; -- 0 строк
SELECT COUNT(*) FROM SalesTarget; -- 20 000 строк

-- Если мы попробуем переключиться снова мы получим ошибку:
ALTER TABLE SalesSource SWITCH TO SalesTarget; 

-- Но если мы попробуем переключиться обратно в пустую таблицу источник, это сработает
ALTER TABLE SalesTarget SWITCH TO SalesSource; 


-- Проверяем снова кол-во строк
SELECT COUNT(*) FROM SalesSource; -- 20 000 строк
SELECT COUNT(*) FROM SalesTarget; -- 0 строк